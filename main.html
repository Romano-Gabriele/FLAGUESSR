<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>FLAGUESSR</title>
</head>
<body>
    <button onclick="start()">Gioca</button>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-analytics.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
        import { ref } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
        import { onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyBCnzOJzpM0eg0gMHiTsyKHTg4qP61ClSA",
          authDomain: "test-bf5e4.firebaseapp.com",
          databaseURL: "https://test-bf5e4-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "test-bf5e4",
          storageBucket: "test-bf5e4.appspot.com",
          messagingSenderId: "131268407638",
          appId: "1:131268407638:web:4886d75d4c9c3ee18fe6f7",
          measurementId: "G-8E66K12NWX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const DBLEN = 195;

        let option, nation;
        let options = [];
        let correct;
        let img;

        // numero random da una lista per evitare nazioni doppie
        function rand() {
            let list = [];
            for(let i = 0; i < DBLEN; i++)
                list.push(i);
            let casuale = Math.floor(Math.random() * list.length);
            option = list[casuale];
            list.splice(casuale, 1);
            nation = `/${option}/`;
        }

        // get bandiera
        function getFlag() {
            rand();
            const dataRef = ref(database, nation);
            onValue(dataRef, (data) => {
                const flag = data.val();
                options.push(flag);
            });
        }

        
        // riempie le 4 opzioni
        function fill() {
            for(let i = 0; i < 4; i++)
                getFlag();
            setTimeout(() => {
                correct = options[0];
                img = correct.URL_ID;
            }, 1000);
        }

        fill();
    </script>
</body> 
</html>